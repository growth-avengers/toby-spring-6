# Section 6: 서비스 추상화

## 강의 내용 정리

<hr/>

### 서비스의 종류
1. 애플리케이션 서비스 @Service
- 애플리케이션 계층에 존재하는 서비스
- 비즈니스 로직을 담당하기 시작하는 시작점, 종료가 되는 경계에 있는 서비스

2. 도메인 서비스 → 자주 안 써봤을 것
- 도메인 모델 패턴을 이용해서 비즈니스 로직을 엔티티같은 도메인 오브젝트에 집어넣을때, 특정 엔티티로는 표현하기 힘든 로직들이 있다.
- 이런 것들을 도메인 서비스 오브젝트를 만들어서 그 안에 넣는다.

3. **`인프라 서비스`**(서비스 추상화의 대상)
- 도메인/애플리케이션 로직에 참여하지않는, 기술을 제공하는 서비스(애플리케이션이 잘 작동하도록 돕는)
- 메일, 캐시, 트랜잭션, 메시징, ….
- **`서비스 추상화 대상`**
- 예시: 이메일 발송
  - 애플리케이션 계층: 이메일 발송을 어떤 식으로 할 것인가, 어떤 내용으로 작성할 것인가 등의 서비스
  - 인프라 계층: 이메일을 SMTP로 전송할 것이냐, 상용 API를 이용해서 전송할 것이냐 등의 서비스

<br/>

### 기술에 독립적인 애플리케이션 서비스
- 의존관계 역전 : DIP를 통해 인터페이스에 의존하게

<br/>

### 추상화
- 구현의 복잡함과 디테일을 감추고 중요한 것만 남기는 기법
- 여러 인프라 서비스 기술의 공통적이고 핵심적인 기능을 인터페이스로 정의하고 이를 구현하는 어댑터를 만들어 일관된 사용이 가능하게 만드는 것이 서비스 추상화
- Adapter: 중간에 각 기술을 사용하는 코드이면서 동시에 추상화된 인터페이스를 구현하도록 만든 중간 변환 작업.

<br/>

### 트랜잭션
- 그 자체로는 애플리케이션의 로직을 갖고 있지 않다.
- 다만 DB 사용시에는 반드시 필요
- 데이터 기술에 따라 방법이 다르다.
- 트랜잭션의 시작과 종료는 애플리케이션 서비스 쪽에서 일어나야한다.
- **이 서비스가 인프라 서비스 안에 존재하면서 어떻게 활용이 되는가?**

<br/>

### 트랜잭션 프록시
- 부가적인 기능으로서 추가되도록
- 트랜잭션을 시작하고 에러가 없으면 커밋하고 에러가 있으면 롤백하는 그런 기능 담당
- 참고 디자인 패턴: 데코레이터 패턴, 프록시 패턴
- **프록시**: 접근제어
  - 클라이언트가 보기에는 프록시인지, RealSubject인지 구분이 되지않는다. 왜냐하면 둘 다 인터페이스를 구현하고 있고 클라이언트는 인터페이스를 통해서만 이 대상을 알고 있게 만든다.
- 어노테이션 활용: @Transactional
- 결과: 프록시를 사용하면 비즈니스 로직만에 집중해서 기술의 변경 때마다 변경되어야하는 코드들을 제거하고 자기가 맡은 책임과 기능에 충실한 코드만 남길 수 있다.


## 느낀점

<hr/>

- 기술에 독립적이어야한다! ex) @Entity
- Config 구성정보는 스프링부트에서는 거의 안 쓰겠지만 잘 알아두어야할 것
  - 강의를 보면 계속해서 구성정보 바꿔줘야하는데, 스프링부트는 이를 자동화한다. 너무 편리
  - interface를 무엇으로 구현했는지
- var 타입
  - 어떤 타입인지 이 뒤에 코드를 보고 컴파일러가 자동으로 이건 Order라는 클래스 타입의 오브젝트겠구나 자동으로 인식해서 실행시켜준다.
    ⇒ 뒷 코드를 보고 무슨 타입인지 한참 생각해야한다면 쓰지 마라. 다만, 생성자 호출, createOrder 등 너무나 명확한 경우에는 괜춘
- DIP를 통해 의존관계를 어떻게 바꾸었는지 잘 생각하고 설명할 줄 알아야
- 인프라 서비스 기술들의 추상화 부분들을 나중에 한번 살펴보자
- Adapter !!!
- DB 최적화 사용을 위해 간혹 JDBC를 사용해야할 수도 있다. 이때, JdbcClient같은 것을 사용하면 간편
- 스프링의 서비스 추상화 대부분
  - 공통적인 기능을 제공하는 다양한 기술들이 있을 때, 이거를 추상화해서 인터페이스를 만들고 
  - 그리고 그 중간에 해당 기술을 이용하도록 적절한 어댑터 클래스 구현을 만들어주면 
  - 이걸 이용하는 클라이언트 쪽은 밑에 세부 기술(JpaTransactionManager)가 뭔지 전혀 신경쓰지않고 공통적인 방식으로 코드 작성 가능.